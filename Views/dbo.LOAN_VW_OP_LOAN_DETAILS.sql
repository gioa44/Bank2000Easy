SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO


CREATE VIEW [dbo].[LOAN_VW_OP_LOAN_DETAILS]
AS
	SELECT
		OP_ID,
		LOAN_ID,
		--OP_LOAN_DETAILS.value('(row/@LOAN_ID)[1]', 'int') AS LOAN_ID, 
		OP_LOAN_DETAILS.value('(row/@CALC_DATE)[1]', 'smalldatetime') AS CALC_DATE, 
		OP_LOAN_DETAILS.value('(row/@PREV_STEP)[1]', 'smalldatetime') AS PREV_STEP, 
		OP_LOAN_DETAILS.value('(row/@NU_PRINCIPAL)[1]', 'money') AS NU_PRINCIPAL,
		OP_LOAN_DETAILS.value('(row/@NU_INTEREST)[1]', 'money') AS NU_INTEREST,
		OP_LOAN_DETAILS.value('(row/@NU_INTEREST_DAILY)[1]', 'money') AS NU_INTEREST_DAILY,
		OP_LOAN_DETAILS.value('(row/@NU_INTEREST_FRACTION)[1]', 'dbo.TFRACTION') AS NU_INTEREST_FRACTION,
		OP_LOAN_DETAILS.value('(row/@PRINCIPAL)[1]', 'money') AS PRINCIPAL,
		OP_LOAN_DETAILS.value('(row/@INTEREST)[1]', 'money') AS INTEREST,
		OP_LOAN_DETAILS.value('(row/@INTEREST_DAILY)[1]', 'money') AS INTEREST_DAILY,
		OP_LOAN_DETAILS.value('(row/@INTEREST_FRACTION)[1]', 'dbo.TFRACTION') AS INTEREST_FRACTION,
		OP_LOAN_DETAILS.value('(row/@LATE_DATE)[1]', 'smalldatetime') AS LATE_DATE,
		OP_LOAN_DETAILS.value('(row/@LATE_PRINCIPAL)[1]', 'money') AS LATE_PRINCIPAL,
		OP_LOAN_DETAILS.value('(row/@LATE_PERCENT)[1]', 'money') AS LATE_PERCENT,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_DATE)[1]', 'smalldatetime') AS OVERDUE_DATE,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PRINCIPAL)[1]', 'money') AS OVERDUE_PRINCIPAL,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PRINCIPAL_INTEREST)[1]', 'money') AS OVERDUE_PRINCIPAL_INTEREST,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PRINCIPAL_INTEREST_DAILY)[1]', 'money') AS OVERDUE_PRINCIPAL_INTEREST_DAILY,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PRINCIPAL_INTEREST_FRACTION)[1]', 'dbo.TFRACTION') AS OVERDUE_PRINCIPAL_INTEREST_FRACTION,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PRINCIPAL_PENALTY)[1]', 'money') AS OVERDUE_PRINCIPAL_PENALTY,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PRINCIPAL_PENALTY_DAILY)[1]', 'money') AS OVERDUE_PRINCIPAL_PENALTY_DAILY,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PRINCIPAL_PENALTY_FRACTION)[1]', 'dbo.TFRACTION') AS OVERDUE_PRINCIPAL_PENALTY_FRACTION,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PERCENT)[1]', 'money') AS OVERDUE_PERCENT,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PERCENT_PENALTY)[1]', 'money') AS OVERDUE_PERCENT_PENALTY,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PERCENT_PENALTY_DAILY)[1]', 'money') AS OVERDUE_PERCENT_PENALTY_DAILY,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_PERCENT_PENALTY_FRACTION)[1]', 'dbo.TFRACTION') AS OVERDUE_PERCENT_PENALTY_FRACTION,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PRINCIPAL)[1]', 'money') AS CALLOFF_PRINCIPAL,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PRINCIPAL_INTEREST)[1]', 'money') AS CALLOFF_PRINCIPAL_INTEREST,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PRINCIPAL_INTEREST_DAILY)[1]', 'money') AS CALLOFF_PRINCIPAL_INTEREST_DAILY,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PRINCIPAL_INTEREST_FRACTION)[1]', 'dbo.TFRACTION') AS CALLOFF_PRINCIPAL_INTEREST_FRACTION,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PRINCIPAL_PENALTY)[1]', 'money') AS CALLOFF_PRINCIPAL_PENALTY,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PRINCIPAL_PENALTY_DAILY)[1]', 'money') AS CALLOFF_PRINCIPAL_PENALTY_DAILY,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PRINCIPAL_PENALTY_FRACTION)[1]', 'dbo.TFRACTION') AS CALLOFF_PRINCIPAL_PENALTY_FRACTION,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PERCENT)[1]', 'money') AS CALLOFF_PERCENT,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PERCENT_PENALTY)[1]', 'money') AS CALLOFF_PERCENT_PENALTY,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PERCENT_PENALTY_DAILY)[1]', 'money') AS CALLOFF_PERCENT_PENALTY_DAILY,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PERCENT_PENALTY_FRACTION)[1]', 'dbo.TFRACTION') AS CALLOFF_PERCENT_PENALTY_FRACTION,
		OP_LOAN_DETAILS.value('(row/@CALLOFF_PENALTY)[1]', 'money') AS CALLOFF_PENALTY,
		OP_LOAN_DETAILS.value('(row/@WRITEOFF_PRINCIPAL)[1]', 'money') AS WRITEOFF_PRINCIPAL,
		OP_LOAN_DETAILS.value('(row/@WRITEOFF_PRINCIPAL_PENALTY)[1]', 'money') AS WRITEOFF_PRINCIPAL_PENALTY,
		OP_LOAN_DETAILS.value('(row/@WRITEOFF_PRINCIPAL_PENALTY_DAILY)[1]', 'money') AS WRITEOFF_PRINCIPAL_PENALTY_DAILY,
		OP_LOAN_DETAILS.value('(row/@WRITEOFF_PRINCIPAL_PENALTY_FRACTION)[1]', 'dbo.TFRACTION') AS WRITEOFF_PRINCIPAL_PENALTY_FRACTION,
		OP_LOAN_DETAILS.value('(row/@WRITEOFF_PERCENT)[1]', 'money') AS WRITEOFF_PERCENT,
		OP_LOAN_DETAILS.value('(row/@WRITEOFF_PERCENT_PENALTY)[1]', 'money') AS WRITEOFF_PERCENT_PENALTY,
		OP_LOAN_DETAILS.value('(row/@WRITEOFF_PERCENT_PENALTY_DAILY)[1]', 'money') AS WRITEOFF_PERCENT_PENALTY_DAILY,
		OP_LOAN_DETAILS.value('(row/@WRITEOFF_PERCENT_PENALTY_FRACTION)[1]', 'dbo.TFRACTION') AS WRITEOFF_PERCENT_PENALTY_FRACTION,
		OP_LOAN_DETAILS.value('(row/@WRITEOFF_PENALTY)[1]', 'money') AS WRITEOFF_PENALTY,
		OP_LOAN_DETAILS.value('(row/@IMMEDIATE_PENALTY)[1]', 'money') AS IMMEDIATE_PENALTY,
		OP_LOAN_DETAILS.value('(row/@FINE)[1]', 'money') AS FINE,
		OP_LOAN_DETAILS.value('(row/@MAX_CATEGORY_LEVEL)[1]', 'tinyint') AS MAX_CATEGORY_LEVEL,
		OP_LOAN_DETAILS.value('(row/@CATEGORY_1)[1]', 'money') AS CATEGORY_1,
		OP_LOAN_DETAILS.value('(row/@CATEGORY_2)[1]', 'money') AS CATEGORY_2,
		OP_LOAN_DETAILS.value('(row/@CATEGORY_3)[1]', 'money') AS CATEGORY_3,
		OP_LOAN_DETAILS.value('(row/@CATEGORY_4)[1]', 'money') AS CATEGORY_4,
		OP_LOAN_DETAILS.value('(row/@CATEGORY_5)[1]', 'money') AS CATEGORY_5,
		OP_LOAN_DETAILS.value('(row/@CATEGORY_6)[1]', 'money') AS CATEGORY_6,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_INSURANCE)[1]', 'money') AS OVERDUE_INSURANCE,
		OP_LOAN_DETAILS.value('(row/@OVERDUE_SERVICE_FEE)[1]', 'money') AS OVERDUE_SERVICE_FEE,
		OP_LOAN_DETAILS.value('(row/@DEFERABLE_INTEREST)[1]', 'money') AS DEFERABLE_INTEREST,
		OP_LOAN_DETAILS.value('(row/@DEFERABLE_OVERDUE_INTEREST)[1]', 'money') AS DEFERABLE_OVERDUE_INTEREST,
		OP_LOAN_DETAILS.value('(row/@DEFERABLE_PENALTY)[1]', 'money') AS DEFERABLE_PENALTY,
		OP_LOAN_DETAILS.value('(row/@DEFERABLE_FINE)[1]', 'money') AS DEFERABLE_FINE,
		OP_LOAN_DETAILS.value('(row/@REMAINING_FEE)[1]', 'money') AS REMAINING_FEE
	FROM dbo.LOAN_OPS
	WHERE OP_LOAN_DETAILS IS NOT NULL
GO
