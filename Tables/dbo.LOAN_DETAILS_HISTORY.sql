CREATE TABLE [dbo].[LOAN_DETAILS_HISTORY]
(
[LOAN_ID] [int] NOT NULL,
[CALC_DATE] [smalldatetime] NOT NULL,
[PREV_STEP] [smalldatetime] NOT NULL,
[NU_PRINCIPAL] [money] NULL,
[NU_INTEREST] [money] NULL,
[NU_INTEREST_DAILY] [money] NULL,
[NU_INTEREST_FRACTION] [dbo].[TFRACTION] NULL,
[PRINCIPAL] [money] NULL,
[INTEREST] [money] NULL,
[INTEREST_DAILY] [money] NULL,
[INTEREST_FRACTION] [dbo].[TFRACTION] NULL,
[LATE_DATE] [smalldatetime] NULL,
[LATE_PRINCIPAL] [money] NULL,
[LATE_PERCENT] [money] NULL,
[OVERDUE_DATE] [smalldatetime] NULL,
[OVERDUE_PRINCIPAL] [money] NULL,
[OVERDUE_PRINCIPAL_INTEREST] [money] NULL,
[OVERDUE_PRINCIPAL_INTEREST_DAILY] [money] NULL,
[OVERDUE_PRINCIPAL_INTEREST_FRACTION] [dbo].[TFRACTION] NULL,
[OVERDUE_PRINCIPAL_PENALTY] [money] NULL,
[OVERDUE_PRINCIPAL_PENALTY_DAILY] [money] NULL,
[OVERDUE_PRINCIPAL_PENALTY_FRACTION] [dbo].[TFRACTION] NULL,
[OVERDUE_PERCENT] [money] NULL,
[OVERDUE_PERCENT_PENALTY] [money] NULL,
[OVERDUE_PERCENT_PENALTY_DAILY] [money] NULL,
[OVERDUE_PERCENT_PENALTY_FRACTION] [dbo].[TFRACTION] NULL,
[CALLOFF_PRINCIPAL] [money] NULL,
[CALLOFF_PRINCIPAL_INTEREST] [money] NULL,
[CALLOFF_PRINCIPAL_INTEREST_DAILY] [money] NULL,
[CALLOFF_PRINCIPAL_INTEREST_FRACTION] [dbo].[TFRACTION] NULL,
[CALLOFF_PRINCIPAL_PENALTY] [money] NULL,
[CALLOFF_PRINCIPAL_PENALTY_DAILY] [money] NULL,
[CALLOFF_PRINCIPAL_PENALTY_FRACTION] [dbo].[TFRACTION] NULL,
[CALLOFF_PERCENT] [money] NULL,
[CALLOFF_PERCENT_PENALTY] [money] NULL,
[CALLOFF_PERCENT_PENALTY_DAILY] [money] NULL,
[CALLOFF_PERCENT_PENALTY_FRACTION] [dbo].[TFRACTION] NULL,
[CALLOFF_PENALTY] [money] NULL,
[WRITEOFF_PRINCIPAL] [money] NULL,
[WRITEOFF_PRINCIPAL_PENALTY] [money] NULL,
[WRITEOFF_PRINCIPAL_PENALTY_DAILY] [money] NULL,
[WRITEOFF_PRINCIPAL_PENALTY_FRACTION] [dbo].[TFRACTION] NULL,
[WRITEOFF_PERCENT] [money] NULL,
[WRITEOFF_PERCENT_PENALTY] [money] NULL,
[WRITEOFF_PERCENT_PENALTY_DAILY] [money] NULL,
[WRITEOFF_PERCENT_PENALTY_FRACTION] [dbo].[TFRACTION] NULL,
[WRITEOFF_PENALTY] [money] NULL,
[IMMEDIATE_PENALTY] [money] NULL,
[FINE] [money] NULL,
[MAX_CATEGORY_LEVEL] [tinyint] NULL,
[CATEGORY_1] [money] NULL,
[CATEGORY_2] [money] NULL,
[CATEGORY_3] [money] NULL,
[CATEGORY_4] [money] NULL,
[CATEGORY_5] [money] NULL,
[CATEGORY_6] [money] NULL,
[OVERDUE_INSURANCE] [money] NULL,
[OVERDUE_SERVICE_FEE] [money] NULL,
[DEFERABLE_INTEREST] [money] NULL,
[DEFERABLE_OVERDUE_INTEREST] [money] NULL,
[DEFERABLE_PENALTY] [money] NULL,
[DEFERABLE_FINE] [money] NULL,
[REMAINING_FEE] [money] NULL
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[LOAN_DETAILS_HISTORY] ADD CONSTRAINT [CK_LOAN_DETAILS_HISTORY_MAX_CATEGORY_LEVEL] CHECK (([MAX_CATEGORY_LEVEL] IS NULL OR [MAX_CATEGORY_LEVEL]=(6) OR [MAX_CATEGORY_LEVEL]=(5) OR [MAX_CATEGORY_LEVEL]=(4) OR [MAX_CATEGORY_LEVEL]=(3) OR [MAX_CATEGORY_LEVEL]=(2) OR [MAX_CATEGORY_LEVEL]=(1)))
GO
ALTER TABLE [dbo].[LOAN_DETAILS_HISTORY] ADD CONSTRAINT [PK_LOAN_DETAILS_HISTORY] PRIMARY KEY CLUSTERED  ([LOAN_ID], [CALC_DATE] DESC) ON [PRIMARY]
GO
ALTER TABLE [dbo].[LOAN_DETAILS_HISTORY] ADD CONSTRAINT [FK_LOAN_DETAILS_HISTORY_LOANS] FOREIGN KEY ([LOAN_ID]) REFERENCES [dbo].[LOANS] ([LOAN_ID]) ON DELETE CASCADE
GO
